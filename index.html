<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026è‡ªå®šä¹‰æ—¥å†ç”Ÿæˆå™¨</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --card-bg: rgba(255, 255, 255, 0.9);
            --text-color: #333333;
            --weekend-color: #4a90e2;
            --holiday-color: #e74c3c;
            --columns: 3;
            --card-width: 320px;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0; padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            height: 100vh; display: flex; overflow: hidden;
            background-color: #1a1a1a; color: #fff;
        }

        /* --- Sidebar --- */
        .sidebar {
            width: 360px; min-width: 360px;
            background: #1e1e1e; border-right: 1px solid #333;
            display: flex; flex-direction: column; z-index: 50;
            box-shadow: 5px 0 15px rgba(0,0,0,0.5);
        }

        .sidebar-header {
            padding: 15px 20px; background: #252526; border-bottom: 1px solid #333;
            display: flex; justify-content: space-between; align-items: center; gap: 10px;
        }
        .sidebar-header h2 { margin: 0; font-size: 1rem; color: #eee; flex: 1; }
        
        .lang-btn {
            background: #333; border: 1px solid #555; color: #fff;
            padding: 4px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8rem;
            transition: 0.2s; white-space: nowrap;
        }
        .lang-btn:hover { background: #4a90e2; border-color: #4a90e2; }

        .scroll-content { padding: 20px; overflow-y: auto; flex: 1; }

        .group {
            background: #2d2d2d; border-radius: 8px; padding: 15px;
            margin-bottom: 15px; border: 1px solid #3e3e3e;
        }
        .group-title {
            font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px;
            color: #4a90e2; margin-bottom: 12px; font-weight: 700;
            border-bottom: 1px solid #444; padding-bottom: 5px;
        }

        .control-item { margin-bottom: 12px; }
        .control-item label { display: block; margin-bottom: 5px; font-size: 0.85rem; color: #bbb; }
        
        .val-display { float: right; color: #4a90e2; font-family: monospace; font-weight: bold; }

        select, input[type="text"], input[type="number"] {
            width: 100%; background: #1a1a1a; border: 1px solid #444;
            color: #fff; padding: 8px; border-radius: 4px; outline: none;
        }
        input[type="range"] { width: 100%; cursor: pointer; accent-color: #4a90e2; }

        .file-upload-wrapper { display: flex; gap: 5px; }
        .file-btn {
            flex: 1; background: #333; border: 1px dashed #666; padding: 8px;
            text-align: center; border-radius: 4px; cursor: pointer; font-size: 0.8rem; color: #ccc;
            overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
        }
        .file-btn:hover { border-color: #4a90e2; color: #fff; }
        input[type="file"] { display: none; }
        .icon-btn {
            width: 36px; background: #333; border: 1px solid #444; color: #e74c3c;
            border-radius: 4px; cursor: pointer; font-size: 1rem; display: flex; align-items: center; justify-content: center;
        }

        .btn {
            width: 100%; padding: 12px; border: none; border-radius: 6px;
            font-size: 0.95rem; font-weight: 600; cursor: pointer; transition: 0.2s;
        }
        .btn-primary { background: #4a90e2; color: white; }
        .btn-primary:hover { background: #357abd; }
        
        .color-row { display: flex; align-items: center; justify-content: space-between; }
        input[type="color"] { background: none; border: none; width: 30px; height: 30px; padding: 0; cursor: pointer; }
        input[type="checkbox"] { width: auto; cursor: pointer; transform: scale(1.2); }

        /* --- Preview Area --- */
        .preview-area {
            flex: 1; position: relative;
            background-color: #222; 
            background-image: linear-gradient(45deg, #2a2a2a 25%, transparent 25%), 
                              linear-gradient(-45deg, #2a2a2a 25%, transparent 25%), 
                              linear-gradient(45deg, transparent 75%, #2a2a2a 75%), 
                              linear-gradient(-45deg, transparent 75%, #2a2a2a 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            
            overflow: auto; 
            padding: 40px;
            display: flex; 
            justify-content: flex-start;
            align-items: flex-start;
        }

        #calendar-container {
            margin: auto;
            position: relative;
            width: fit-content;
            height: fit-content;
            background-color: #f0f2f5; 
            box-shadow: 0 0 40px rgba(0,0,0,0.6);
            box-sizing: border-box; 
            overflow: hidden;
            transform-origin: top left;
            transition: background-color 0.3s, box-shadow 0.3s;
        }

        .global-bg-layer {
            position: absolute; top: 0; left: 0; 
            width: 100%; height: 100%; 
            z-index: 1; pointer-events: none;
            background-size: cover; background-position: center;
        }

        .content-layer {
            position: relative; z-index: 10; padding: 50px;
            min-width: fit-content;
        }

        .main-title {
            text-align: center; font-size: 4.5rem; font-weight: 800;
            color: var(--text-color); margin: 0 0 40px 0; letter-spacing: 5px;
            white-space: nowrap; font-family: 'Helvetica Neue', Arial, sans-serif;
            outline: none; text-shadow: 2px 2px 10px rgba(0,0,0,0.1);
        }
        .main-title:focus { border-bottom: 2px dashed #4a90e2; }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(var(--columns), var(--card-width));
            gap: 30px;
        }

        .month-card {
            position: relative;
            background-color: var(--card-bg);
            padding: 20px; border-radius: 12px;
            border: 1px solid rgba(0,0,0,0.05);
            overflow: hidden; isolation: isolate;
        }

        .month-card-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; background-size: cover; background-position: center;
        }
        
        .month-card-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; background-color: var(--card-bg);
        }

        .month-title {
            text-align: center; font-size: 1.5rem; color: var(--text-color);
            margin-bottom: 15px; font-weight: 700; padding-bottom: 10px;
            border-bottom: 2px solid rgba(100,100,100,0.1);
        }

        .days-grid {
            display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; 
            row-gap: 5px; /* ç½‘æ ¼è¡Œé—´è· */
        }

        /* ä¿®æ”¹ï¼šæ˜ŸæœŸè¡¨å¤´é«˜åº¦ç»Ÿä¸€ä¸º 50pxï¼Œä¸æ—¥æœŸæ ¼ä¸€è‡´ï¼Œè§£å†³è¡Œé—´è·è§†è§‰å·® */
        .weekday-header {
            font-size: 0.9rem; font-weight: bold; color: var(--text-color); opacity: 0.7; 
            height: 60px; /* å…³é”®ä¿®æ”¹ï¼šé«˜åº¦ä¸ day-cell ä¸€è‡´ */
            display: flex; align-items: center; justify-content: center;
            margin-bottom: 0;
        }

        .day-cell {
            display: flex; flex-direction: column; align-items: center; 
            height: 50px; /* æ—¥æœŸæ ¼é«˜åº¦ */
            font-size: 1.1rem; color: var(--text-color);
            justify-content: flex-start; /* æ—¥æœŸæ•°å­—é ä¸Šï¼Œç•™ç»™èŠ‚æ—¥ä½ç½® */
            padding-top: 5px; /* å¾®è°ƒæ•°å­—ä½ç½® */
        }
        
        .day-cell.weekend .date-num { color: var(--weekend-color); }
        .day-cell.is-holiday .date-num { color: var(--holiday-color); font-weight: bold; }
        .holiday-label {
            font-size: 0.6rem; color: var(--holiday-color); transform: scale(0.85); white-space: nowrap; margin-top: 2px;
        }

        .author-statement {
            margin-top: 40px; text-align: center; font-size: 0.9rem;
            color: var(--text-color); opacity: 0.7; font-weight: 500;
            outline: none; border: 1px dashed transparent; padding: 5px;
        }
        .author-statement:hover, .author-statement:focus { border-color: #4a90e2; opacity: 1; }

        /* --- è‡ªå®šä¹‰æ¨¡æ€æ¡†æ ·å¼ --- */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7); z-index: 1000;
            justify-content: center; align-items: center;
            backdrop-filter: blur(5px);
        }
        .modal-box {
            background: #2d2d2d; color: #fff; padding: 30px; border-radius: 12px;
            width: 90%; max-width: 450px; text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 1px solid #444;
        }
        .modal-title { font-size: 1.2rem; font-weight: bold; margin-bottom: 15px; color: #4a90e2; }
        .modal-content { font-size: 0.95rem; line-height: 1.6; margin-bottom: 25px; color: #ccc; }
        .modal-btns { display: flex; gap: 15px; justify-content: center; }
        .modal-btn {
            padding: 10px 25px; border-radius: 6px; border: none; cursor: pointer; font-size: 0.95rem; font-weight: bold;
        }
        .btn-confirm { background: #4a90e2; color: white; }
        .btn-confirm:hover { background: #357abd; }
        .btn-cancel { background: #444; color: #ccc; }
        .btn-cancel:hover { background: #555; }

        @media (max-width: 900px) {
            body { flex-direction: column; overflow: auto; }
            .sidebar { width: 100%; min-width: 100%; height: auto; border-right: none; }
            #calendar-container { margin: 0; width: 100%; border-radius: 0; }
            .calendar-grid { grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
            .main-title { font-size: 3rem; }
        }
    </style>
</head>
<body>

    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>ğŸ› ï¸ <span id="ui-app-title">Calendar Gen</span></h2>
            <button class="lang-btn" onclick="toggleUILanguage()">ä¸­æ–‡ / English</button>
            <button class="btn-primary" style="width: auto; padding: 5px 10px; font-size: 0.8rem; background:#c0392b;" onclick="resetAll()" id="ui-btn-reset">Reset</button>
        </div>
        
        <div class="scroll-content">
            <!-- 1. ç¼–è¾‘ç›®æ ‡é€‰æ‹© -->
            <div class="group" style="border-color: #4a90e2;">
                <div class="group-title" id="ui-step1">Target</div>
                <div class="control-item">
                    <select id="edit-target" onchange="updateUIForTarget()">
                        <option value="global" id="opt-global">ğŸŒ Global Background</option>
                        <option disabled>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</option>
                        <option value="0" id="opt-m1">ğŸ“… January</option>
                        <option value="1" id="opt-m2">ğŸ“… February</option>
                        <option value="2" id="opt-m3">ğŸ“… March</option>
                        <option value="3" id="opt-m4">ğŸ“… April</option>
                        <option value="4" id="opt-m5">ğŸ“… May</option>
                        <option value="5" id="opt-m6">ğŸ“… June</option>
                        <option value="6" id="opt-m7">ğŸ“… July</option>
                        <option value="7" id="opt-m8">ğŸ“… August</option>
                        <option value="8" id="opt-m9">ğŸ“… September</option>
                        <option value="9" id="opt-m10">ğŸ“… October</option>
                        <option value="10" id="opt-m11">ğŸ“… November</option>
                        <option value="11" id="opt-m12">ğŸ“… December</option>
                    </select>
                </div>
            </div>

            <!-- 2. å›¾ç‰‡æ§åˆ¶ -->
            <div class="group">
                <div class="group-title" id="ui-img-settings">Image Settings</div>
                
                <div class="control-item">
                    <label id="ui-lbl-upload">Upload / Replace</label>
                    <div class="file-upload-wrapper">
                        <label class="file-btn">
                            <span id="upload-status-text">ç‚¹å‡»ä¸Šä¼  Click to upload...</span>
                            <input type="file" id="img-upload" accept="image/*" onchange="handleImageUpload(this)">
                        </label>
                        <button class="icon-btn" onclick="clearTargetImage()" title="Clear">Ã—</button>
                    </div>
                </div>

                <div class="control-item">
                    <label>
                        <span id="ui-lbl-opacity">Opacity</span>
                        <span class="val-display" id="disp-img-opacity">100%</span>
                    </label>
                    <input type="range" id="img-opacity" min="0" max="100" value="100" oninput="updateTargetStyle('opacity', this.value)">
                </div>

                <div class="control-item">
                    <label id="ui-lbl-size">Size Mode</label>
                    <select id="img-size" onchange="updateTargetStyle('size', this.value)">
                        <option value="cover" id="opt-size-cover">Cover (Fill)</option>
                        <option value="contain" id="opt-size-contain">Contain (Fit)</option>
                        <option value="100% 100%" id="opt-size-stretch">Stretch</option>
                    </select>
                </div>

                <div class="control-item">
                    <label id="ui-lbl-pos">Position</label>
                    <select id="img-pos" onchange="updateTargetStyle('pos', this.value)">
                        <option value="center" id="opt-pos-center">Center</option>
                        <option value="top" id="opt-pos-top">Top</option>
                        <option value="bottom" id="opt-pos-bottom">Bottom</option>
                        <option value="left" id="opt-pos-left">Left</option>
                        <option value="right" id="opt-pos-right">Right</option>
                    </select>
                </div>
            </div>

            <!-- 3. å…¨å±€å¸ƒå±€ -->
            <div class="group">
                <div class="group-title" id="ui-global-style">Global Style</div>
                
                <!-- é€æ˜æ¨¡å¼å¼€å…³ -->
                <div class="control-item">
                    <label style="display:flex; align-items:center; cursor:pointer;">
                        <input type="checkbox" id="transparent-mode" onchange="toggleTransparentMode(this.checked)" style="margin-right:8px;">
                        <span id="ui-lbl-transparent">Transparent Mode (PNG)</span>
                    </label>
                </div>

                <div class="control-item">
                    <div class="color-row">
                        <label id="ui-lbl-bg-color">Global Bg Color</label>
                        <input type="color" id="global-bg-picker" value="#f0f2f5" oninput="updateWrapperColor(this.value)">
                    </div>
                </div>

                <div class="control-item">
                    <label id="ui-lbl-layout">Columns: <span id="col-display">3</span></label>
                    <input type="range" min="1" max="6" value="3" oninput="updateColumns(this.value)">
                </div>

                <div class="control-item">
                    <label id="ui-lbl-format">Calendar Language</label>
                    <select id="month-format" onchange="renderCalendar()">
                        <option value="zh-normal">ä¸­æ–‡ (ä¸€æœˆ)</option>
                        <option value="zh-num">æ•°å­— (1æœˆ)</option>
                        <option value="en-short">English Short (Jan)</option>
                        <option value="en-long">English Long (January)</option>
                    </select>
                </div>

                <div class="control-item">
                    <div class="color-row">
                        <label id="ui-lbl-card-color">Card Color</label>
                        <input type="color" id="card-bg-picker" value="#ffffff" oninput="updateColor('--card-bg', this.value, true)">
                    </div>
                    <!-- è’™å±‚é€æ˜åº¦æ•°å€¼æ˜¾ç¤º -->
                    <div style="display:flex; justify-content:space-between; margin-top:5px; font-size:0.8rem; color:#bbb;">
                        <span>Overlay Opacity</span>
                        <span id="disp-card-alpha" style="color:#4a90e2; font-weight:bold;">90%</span>
                    </div>
                    <input type="range" id="card-alpha-slider" min="0" max="255" value="230" style="margin-top:2px;" oninput="updateColor('--card-bg', document.getElementById('card-bg-picker').value, true)">
                </div>

                <div class="control-item">
                    <div class="color-row">
                        <label id="ui-lbl-text-color">Text Color</label>
                        <input type="color" value="#333333" oninput="updateColor('--text-color', this.value)">
                    </div>
                </div>
                
                <!-- åŠ å›çš„å‘¨æœ«å’ŒèŠ‚æ—¥é¢œè‰²è®¾ç½® -->
                <div class="control-item">
                    <div class="color-row">
                        <label id="ui-lbl-weekend-color">Weekend Highlight</label>
                        <input type="color" value="#4a90e2" oninput="updateColor('--weekend-color', this.value)">
                    </div>
                </div>
                 <div class="control-item">
                    <div class="color-row">
                        <label id="ui-lbl-holiday-color">Holiday Highlight</label>
                        <input type="color" value="#e74c3c" oninput="updateColor('--holiday-color', this.value)">
                    </div>
                </div>

            </div>

            <button class="btn btn-primary" id="download-btn" onclick="showExportModal()">
                ğŸ“¥ Export PNG
            </button>

            <!-- ä¸è’œå­ç»Ÿè®¡ -->
            <div style="margin-top: 25px; text-align: center; font-size: 0.75rem; color: #777; padding-bottom: 20px;">
                <span id="busuanzi_container_site_pv" style="display:none;">
                    æ€»è®¿é—®é‡ <span id="busuanzi_value_site_pv" style="color: #4a90e2; font-weight: bold;"></span>
                </span>
                <span style="margin: 0 5px;">|</span>
                <span id="busuanzi_container_site_uv" style="display:none;">
                    æ€»è®¿å®¢æ•° <span id="busuanzi_value_site_uv" style="color: #4a90e2; font-weight: bold;"></span>
                </span>
            </div>
            
        </div>
    </aside>

    <main class="preview-area">
        <div id="calendar-container">
            <div class="global-bg-layer" id="global-bg"></div>
            
            <div class="content-layer">
                <h1 class="main-title" contenteditable="true">2026</h1>
                <div class="calendar-grid" id="calendar-grid">
                    <!-- JS ç”Ÿæˆæœˆä»½ -->
                </div>
                <div class="author-statement" contenteditable="true" id="author-text">
                    Designed by Syuga 2026
                </div>
            </div>
        </div>
    </main>

    <!-- è‡ªå®šä¹‰æç¤ºæ¨¡æ€æ¡† -->
    <div id="custom-modal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-title" id="modal-title-text">æ¸©é¦¨æç¤º / Reminder</div>
            <div class="modal-content" id="modal-content-text">
                è¯·ç¡®ä¿æ‚¨ç”Ÿæˆçš„å†…å®¹ä»…é™äºä¸ªäººä½¿ç”¨ã€‚<br>æ“…è‡ªæ‹¿å»å•†ç”¨çš„å¥½è´¢è¿ä¼šè½¬ç§»åˆ°æˆ‘èº«ä¸Šå“¦:)<br><br>
                Please ensure that the content you generate is for personal use only.<br> If you use it for commercial purposes without permission, you'll end up broke. You know how it goes :)
            </div>
            <div class="modal-btns">
                <button class="modal-btn btn-cancel" onclick="closeModal()">å–æ¶ˆ Cancel</button>
                <button class="modal-btn btn-confirm" onclick="processExport()">æ‰¿è¯ºå¹¶ä¸‹è½½ Download</button>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥ä¸è’œå­è„šæœ¬ -->
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <script>
        let currentUILang = 'zh'; 
        
        const UI_TEXT = {
            zh: {
                title: "æ—¥å†ç”Ÿæˆå™¨", reset: "é‡ç½®", step1: "ğŸ¯ å›¾ç‰‡åº”ç”¨", optGlobal: "ğŸŒ å…¨å±€å¤§èƒŒæ™¯",
                months: ["1æœˆ", "2æœˆ", "3æœˆ", "4æœˆ", "5æœˆ", "6æœˆ", "7æœˆ", "8æœˆ", "9æœˆ", "10æœˆ", "11æœˆ", "12æœˆ"],
                imgSettings: "ğŸ–¼ï¸ å›¾ç‰‡è®¾ç½®", lblUpload: "ä¸Šä¼  / æ›´æ¢å›¾ç‰‡", txtUpload: "ç‚¹å‡»é€‰æ‹©å›¾ç‰‡...", txtUploaded: "âœ… å·²æœ‰å›¾ç‰‡ (ç‚¹å‡»æ›´æ¢)",
                lblOpacity: "é€æ˜åº¦", lblSize: "è£åˆ‡æ¨¡å¼", lblPos: "å¯¹é½ä½ç½®",
                globalStyle: "ğŸ¨ å…¨å±€æ ·å¼", lblTransparent: "å¼€å¯é€æ˜åº• (é€‚åˆPS/è´´å›¾)", lblBgColor: "å…¨å±€åº•è‰²",
                lblLayout: "æ¯è¡Œæ˜¾ç¤ºæœˆä»½æ•°", lblFormat: "æ—¥å†è¯­è¨€æ ¼å¼",
                lblCardColor: "å¡ç‰‡åº•è‰² / è’™å±‚", lblTextColor: "æ–‡å­—é¢œè‰²", lblWeekend: "å‘¨æœ«é«˜äº®", lblHoliday: "èŠ‚æ—¥é«˜äº®",
                btnExport: "ğŸ“¥ å¯¼å‡ºé«˜æ¸… PNG", author: "ä½œè€…ï¼šSyugaã€‚ä»…é™è‡ªç”¨ï¼Œå•†ç”¨è¯·è”ç³»å°çº¢ä¹¦/æŠ–éŸ³ï¼šåˆè€åˆè„†å¼±ï¼ˆç‚¹å‡»ä¿®æ”¹æˆ–åˆ é™¤ï¼‰",
                // Options
                optCover: "é“ºæ»¡ (Cover)", optContain: "å®Œæ•´ (Contain)", optStretch: "æ‹‰ä¼¸ (Stretch)",
                optCenter: "å±…ä¸­ (Center)", optTop: "é¡¶éƒ¨ (Top)", optBottom: "åº•éƒ¨ (Bottom)", optLeft: "å·¦ä¾§ (Left)", optRight: "å³ä¾§ (Right)"
            },
            en: {
                title: "Calendar Gen", reset: "Reset", step1: "ğŸ¯ Target Selection", optGlobal: "ğŸŒ Global Background",
                months: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
                imgSettings: "ğŸ–¼ï¸ Image Settings", lblUpload: "Upload / Replace", txtUpload: "Click to upload...", txtUploaded: "âœ… Image Set (Click change)",
                lblOpacity: "Opacity", lblSize: "Size Mode", lblPos: "Position",
                globalStyle: "ğŸ¨ Global Style", lblTransparent: "Transparent Mode (No Bg)", lblBgColor: "Global Bg Color",
                lblLayout: "Columns per row", lblFormat: "Calendar Format",
                lblCardColor: "Card Color / Overlay", lblTextColor: "Text Color", lblWeekend: "Weekend Highlight", lblHoliday: "Holiday Highlight",
                btnExport: "ğŸ“¥ Export PNG", author: "Author:Syuga. For personal use only. For commercial use, please contact Xiaohongshu/Douyin:åˆè€åˆè„†å¼± (Click to edit or delete)",
                // Options
                optCover: "Cover (Fill)", optContain: "Contain (Fit)", optStretch: "Stretch",
                optCenter: "Center", optTop: "Top", optBottom: "Bottom", optLeft: "Left", optRight: "Right"
            }
        };

        const CAL_DATA = {
            zh: {
                months: ["ä¸€æœˆ", "äºŒæœˆ", "ä¸‰æœˆ", "å››æœˆ", "äº”æœˆ", "å…­æœˆ", "ä¸ƒæœˆ", "å…«æœˆ", "ä¹æœˆ", "åæœˆ", "åä¸€æœˆ", "åäºŒæœˆ"],
                monthsNum: ["1æœˆ", "2æœˆ", "3æœˆ", "4æœˆ", "5æœˆ", "6æœˆ", "7æœˆ", "8æœˆ", "9æœˆ", "10æœˆ", "11æœˆ", "12æœˆ"],
                // ä¿®æ”¹ï¼šå‘¨ä¸€å¼€å¤´
                weekDays: ["ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­", "æ—¥"],
                holidays: { 
                    "1-1": "å…ƒæ—¦", "1-26": "è…Šå…«", "2-11": "å°å¹´", "2-14": "æƒ…äººèŠ‚", 
                    "2-16": "é™¤å¤•", "2-17": "æ˜¥èŠ‚", "3-3": "å…ƒå®µ", "3-8": "å¦‡å¥³èŠ‚", "3-12": "æ¤æ ‘èŠ‚",
                    "4-1": "æ„šäººèŠ‚", "4-5": "æ¸…æ˜", "5-1": "åŠ³åŠ¨èŠ‚", "5-4": "é’å¹´èŠ‚", "5-10": "æ¯äº²èŠ‚", "5-20": "520",
                    "6-1": "å„¿ç«¥èŠ‚", "6-19": "ç«¯åˆ", "6-21": "çˆ¶äº²èŠ‚", "7-1": "å»ºå…šèŠ‚", "8-1": "å»ºå†›èŠ‚",
                    "8-19": "ä¸ƒå¤•", "8-27": "ä¸­å…ƒèŠ‚", "9-10": "æ•™å¸ˆèŠ‚", "9-25": "ä¸­ç§‹", 
                    "10-1": "å›½åº†", "10-18": "é‡é˜³", "10-31": "ä¸‡åœ£å¤œ", "11-26": "æ„Ÿæ©èŠ‚",
                    "12-24": "å¹³å®‰å¤œ", "12-25": "åœ£è¯" 
                }
            },
            en: {
                monthsShort: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
                monthsLong: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
                // ä¿®æ”¹ï¼šå‘¨ä¸€å¼€å¤´
                weekDays: ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"],
                holidays: { 
                    "1-1": "New Year", "1-26": "Laba Fest", "2-14": "Valentine", "2-17": "Lunar NY", 
                    "3-8": "Women's Day", "4-1": "April Fools", "4-5": "Qingming", 
                    "5-1": "Labor Day", "5-10": "Mother's Day", 
                    "6-1": "Children's Day", "6-19": "Dragon Boat", "6-21": "Father's Day", 
                    "8-19": "Qixi", "8-27": "Ghost Fest", "9-25": "Mid-Autumn", 
                    "10-1": "National Day", "10-31": "Halloween", "11-26": "Thanksgiving", 
                    "12-24": "Xmas Eve", "12-25": "Christmas" 
                }
            }
        };

        const defaultState = {
            global: { img: null, opacity: 100, size: 'cover', pos: 'center' },
            months: Array(12).fill(null).map(() => ({ img: null, opacity: 100, size: 'cover', pos: 'center' }))
        };
        let appState = JSON.parse(JSON.stringify(defaultState));
        const year = 2026;

        function init() {
            renderCalendar();
            updateUILanguage();
        }

        function toggleUILanguage() {
            currentUILang = currentUILang === 'zh' ? 'en' : 'zh';
            updateUILanguage();
            updateUIForTarget();
        }

        function updateUILanguage() {
            const txt = UI_TEXT[currentUILang];
            document.getElementById('ui-app-title').innerText = txt.title;
            document.getElementById('ui-btn-reset').innerText = txt.reset;
            document.getElementById('ui-step1').innerText = txt.step1;
            document.getElementById('opt-global').innerText = txt.optGlobal;
            for(let i=0; i<12; i++) document.getElementById(`opt-m${i+1}`).innerText = `ğŸ“… ${txt.months[i]}`;
            
            document.getElementById('ui-img-settings').innerText = txt.imgSettings;
            document.getElementById('ui-lbl-upload').innerText = txt.lblUpload;
            document.getElementById('ui-lbl-opacity').innerText = txt.lblOpacity;
            document.getElementById('ui-lbl-size').innerText = txt.lblSize;
            document.getElementById('ui-lbl-pos').innerText = txt.lblPos;

            // Update Options Text
            document.getElementById('opt-size-cover').innerText = txt.optCover;
            document.getElementById('opt-size-contain').innerText = txt.optContain;
            document.getElementById('opt-size-stretch').innerText = txt.optStretch;
            document.getElementById('opt-pos-center').innerText = txt.optCenter;
            document.getElementById('opt-pos-top').innerText = txt.optTop;
            document.getElementById('opt-pos-bottom').innerText = txt.optBottom;
            document.getElementById('opt-pos-left').innerText = txt.optLeft;
            document.getElementById('opt-pos-right').innerText = txt.optRight;

            document.getElementById('ui-global-style').innerText = txt.globalStyle;
            document.getElementById('ui-lbl-transparent').innerText = txt.lblTransparent;
            document.getElementById('ui-lbl-bg-color').innerText = txt.lblBgColor;
            document.getElementById('ui-lbl-layout').childNodes[0].nodeValue = txt.lblLayout + ": ";
            document.getElementById('ui-lbl-format').innerText = txt.lblFormat;
            document.getElementById('ui-lbl-card-color').innerText = txt.lblCardColor;
            document.getElementById('ui-lbl-text-color').innerText = txt.lblTextColor;
            document.getElementById('ui-lbl-weekend-color').innerText = txt.lblWeekend;
            document.getElementById('ui-lbl-holiday-color').innerText = txt.lblHoliday;
            
            document.getElementById('download-btn').innerText = txt.btnExport;
            
            const authorDiv = document.getElementById('author-text');
            if(authorDiv.innerText.includes("Designed by") || authorDiv.innerText.includes("ä½œè€…ï¼š")) {
                authorDiv.innerText = txt.author;
            }
        }

        function renderCalendar() {
            const grid = document.getElementById('calendar-grid');
            grid.innerHTML = '';
            const format = document.getElementById('month-format').value;
            let monthLabels, weekData, holidayData;

            if (format.startsWith('zh')) {
                weekData = CAL_DATA.zh.weekDays;
                holidayData = CAL_DATA.zh.holidays;
                monthLabels = format === 'zh-num' ? CAL_DATA.zh.monthsNum : CAL_DATA.zh.months;
            } else {
                weekData = CAL_DATA.en.weekDays;
                holidayData = CAL_DATA.en.holidays;
                monthLabels = format === 'en-short' ? CAL_DATA.en.monthsShort : CAL_DATA.en.monthsLong;
            }

            for (let i = 0; i < 12; i++) {
                const monthCard = document.createElement('div');
                monthCard.className = 'month-card';
                monthCard.id = `month-card-${i}`;

                const bgLayer = document.createElement('div');
                bgLayer.className = 'month-card-bg';
                bgLayer.id = `month-bg-${i}`;
                const mState = appState.months[i];
                if(mState.img) {
                    bgLayer.style.backgroundImage = `url(${mState.img})`;
                    bgLayer.style.opacity = mState.opacity / 100;
                    bgLayer.style.backgroundSize = mState.size;
                    bgLayer.style.backgroundPosition = mState.pos;
                }
                monthCard.appendChild(bgLayer);

                const overlay = document.createElement('div');
                overlay.className = 'month-card-overlay';
                monthCard.appendChild(overlay);

                const title = document.createElement('div');
                title.className = 'month-title';
                title.innerText = monthLabels[i];
                monthCard.appendChild(title);

                const daysDiv = document.createElement('div');
                daysDiv.className = 'days-grid';

                weekData.forEach(d => {
                    const h = document.createElement('div');
                    h.className = 'weekday-header';
                    h.innerText = d;
                    daysDiv.appendChild(h);
                });

                // ä¿®æ”¹ï¼šè®¡ç®—æ¯å‘¨ä»å‘¨ä¸€å¼€å§‹çš„ç©ºç™½æ ¼
                // getDay(): 0(Sun), 1(Mon)... 6(Sat)
                let firstDay = new Date(year, i, 1).getDay();
                // è½¬æ¢: Mon(1)->0, Tue(2)->1, ..., Sat(6)->5, Sun(0)->6
                firstDay = (firstDay === 0 ? 6 : firstDay - 1);

                const daysInMonth = new Date(year, i+1, 0).getDate();
                for(let j=0; j<firstDay; j++) daysDiv.appendChild(document.createElement('div'));

                for(let d=1; d<=daysInMonth; d++) {
                    const cell = document.createElement('div');
                    cell.className = 'day-cell';
                    
                    // è®¡ç®—æ˜¯å¦å‘¨æœ« (å‘¨å…­å’Œå‘¨æ—¥ï¼Œå¯¹åº”æ–°çš„index 5å’Œ6)
                    const dayOfWeek = new Date(year, i, d).getDay();
                    if(dayOfWeek === 0 || dayOfWeek === 6) {
                        cell.classList.add('weekend');
                    }

                    const num = document.createElement('span');
                    num.className = 'date-num';
                    num.innerText = d;
                    cell.appendChild(num);
                    const key = `${i+1}-${d}`;
                    if(holidayData[key]) {
                        cell.classList.add('is-holiday');
                        const lbl = document.createElement('span');
                        lbl.className = 'holiday-label';
                        lbl.innerText = holidayData[key];
                        cell.appendChild(lbl);
                    }
                    daysDiv.appendChild(cell);
                }
                monthCard.appendChild(daysDiv);
                grid.appendChild(monthCard);
            }

            const gBg = document.getElementById('global-bg');
            const gState = appState.global;
            if (gState.img) {
                gBg.style.backgroundImage = `url(${gState.img})`;
                gBg.style.opacity = gState.opacity / 100;
                gBg.style.backgroundSize = gState.size;
                gBg.style.backgroundPosition = gState.pos;
            } else {
                gBg.style.backgroundImage = 'none';
            }
        }

        function getCurrentTarget() { return document.getElementById('edit-target').value; }
        function updateUIForTarget() {
            const target = getCurrentTarget();
            let state = target === 'global' ? appState.global : appState.months[parseInt(target)];
            const status = document.getElementById('upload-status-text');
            const txt = UI_TEXT[currentUILang];

            document.getElementById('img-opacity').value = state.opacity;
            document.getElementById('disp-img-opacity').innerText = state.opacity + '%';

            document.getElementById('img-size').value = state.size;
            document.getElementById('img-pos').value = state.pos;
            
            if (state.img) {
                status.innerText = txt.txtUploaded;
                status.style.color = "#4a90e2";
            } else {
                status.innerText = txt.txtUpload;
                status.style.color = "#ccc";
            }
        }
        function handleImageUpload(input) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const target = getCurrentTarget();
                if (target === 'global') appState.global.img = e.target.result;
                else appState.months[parseInt(target)].img = e.target.result;
                renderCalendar();
                updateUIForTarget();
                input.value = '';
            };
            reader.readAsDataURL(file);
        }
        function clearTargetImage() {
            const target = getCurrentTarget();
            if (target === 'global') appState.global.img = null;
            else appState.months[parseInt(target)].img = null;
            renderCalendar();
            updateUIForTarget();
        }
        function updateTargetStyle(prop, value) {
            const target = getCurrentTarget();
            const state = target === 'global' ? appState.global : appState.months[parseInt(target)];
            const domEl = target === 'global' ? document.getElementById('global-bg') : document.getElementById(`month-bg-${target}`);
            state[prop] = value;
            
            if (prop === 'opacity') {
                domEl.style.opacity = value / 100;
                document.getElementById('disp-img-opacity').innerText = value + '%';
            }
            if (prop === 'size') domEl.style.backgroundSize = value;
            if (prop === 'pos') domEl.style.backgroundPosition = value;
        }
        
        function toggleTransparentMode(checked) {
            const container = document.getElementById('calendar-container');
            const picker = document.getElementById('global-bg-picker');
            
            if(checked) {
                container.style.backgroundColor = 'transparent';
                container.style.boxShadow = 'none';
            } else {
                container.style.backgroundColor = picker.value;
                container.style.boxShadow = '0 0 40px rgba(0,0,0,0.6)';
            }
        }

        function updateWrapperColor(hex) {
            const container = document.getElementById('calendar-container');
            const checkBox = document.getElementById('transparent-mode');
            if(checkBox.checked) {
                checkBox.checked = false;
                container.style.boxShadow = '0 0 40px rgba(0,0,0,0.6)';
            }
            container.style.backgroundColor = hex;
        }

        function updateColor(varName, hexValue, isCardBg = false) {
            let finalValue = hexValue;
            if (isCardBg) {
                const alpha = document.getElementById('card-alpha-slider').value;
                const pct = Math.round((alpha / 255) * 100);
                document.getElementById('disp-card-alpha').innerText = pct + '%';
                
                const r = parseInt(hexValue.slice(1, 3), 16);
                const g = parseInt(hexValue.slice(3, 5), 16);
                const b = parseInt(hexValue.slice(5, 7), 16);
                finalValue = `rgba(${r}, ${g}, ${b}, ${alpha / 255})`;
            }
            document.documentElement.style.setProperty(varName, finalValue);
        }
        function updateColumns(val) {
            document.documentElement.style.setProperty('--columns', val);
            document.getElementById('col-display').innerText = val;
        }
        function resetAll() {
            if(confirm("Reset all settings?")) {
                appState = JSON.parse(JSON.stringify(defaultState));
                document.getElementById('card-alpha-slider').value = 230;
                document.getElementById('disp-card-alpha').innerText = '90%';
                
                updateColor('--card-bg', '#ffffff', false); 
                document.documentElement.style.setProperty('--card-bg', 'rgba(255,255,255,0.9)');
                document.documentElement.style.setProperty('--columns', 3);
                document.getElementById('transparent-mode').checked = false;
                document.getElementById('calendar-container').style.backgroundColor = '#f0f2f5';
                document.getElementById('calendar-container').style.boxShadow = '0 0 40px rgba(0,0,0,0.6)';
                document.getElementById('global-bg-picker').value = '#f0f2f5';
                
                renderCalendar();
                updateUIForTarget();
            }
        }

        // --- æ¨¡æ€æ¡†é€»è¾‘ ---
        function showExportModal() {
            document.getElementById('custom-modal').style.display = 'flex';
        }
        function closeModal() {
            document.getElementById('custom-modal').style.display = 'none';
        }
        function processExport() {
            closeModal();
            // å¼€å§‹å¯¼å‡ºé€»è¾‘
            const original = document.getElementById("calendar-container");
            const btn = document.getElementById('download-btn');
            
            const originalText = btn.innerText;
            btn.innerText = "â³ Processing...";
            btn.disabled = true;

            const clone = original.cloneNode(true);
            const wrapper = document.createElement('div');
            wrapper.style.position = 'fixed';
            wrapper.style.top = '-10000px';
            wrapper.style.left = '-10000px';
            wrapper.style.zIndex = '-1000';
            
            const realWidth = original.scrollWidth;
            const realHeight = original.scrollHeight;
            
            clone.style.width = realWidth + 'px';
            clone.style.height = realHeight + 'px';
            clone.style.margin = '0';
            clone.style.transform = 'none';
            clone.style.overflow = 'hidden'; 
            
            wrapper.appendChild(clone);
            document.body.appendChild(wrapper);

            html2canvas(clone, {
                scale: 2, 
                useCORS: true,
                backgroundColor: null,
                width: realWidth,
                height: realHeight,
                windowWidth: realWidth,
                windowHeight: realHeight
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `Calendar_2026_${new Date().getTime()}.png`;
                link.href = canvas.toDataURL("image/png");
                link.click();
                
                document.body.removeChild(wrapper);
                btn.innerText = originalText;
                btn.disabled = false;
            }).catch(err => {
                console.error(err);
                alert("Export Failed.");
                if(document.body.contains(wrapper)) document.body.removeChild(wrapper);
                btn.innerText = originalText;
                btn.disabled = false;
            });
        }

        init();
    </script>
</body>
</html>
